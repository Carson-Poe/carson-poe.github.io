<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>david_big_mac_stream.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Carson Poe</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="david_big_mac_stream.html">David Robinson Big Mac Follow</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<hr />
<p>title: ‘Working Tidy with David’ output: html_document</p>
<hr />
<pre class="r"><code>library(tidymodels)
library(tidyverse)
library(GGally)
library(countrycode)
library(scales)
theme_set(theme_light())
library(ggrepel)
library(gganimate)
knitr::opts_chunk$set(echo = T, warning = FALSE, message = FALSE, cache = TRUE, dpi = 180, fig.width = 8, fig.height = 5)

options(scipen = 9999)</code></pre>
<div id="coding-with-david-robinson" class="section level1">
<h1>Coding with David Robinson</h1>
<p><a href="https://www.youtube.com/user/safe4democracy/videos">David Robinson, the wizard himself</a></p>
<div id="tidy-tuesday" class="section level2">
<h2>Tidy Tuesday</h2>
<div id="reading-in-data" class="section level3">
<h3>Reading in data</h3>
<pre class="r"><code>big_mac &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-12-22/big-mac.csv&#39;)

big_mac &lt;- big_mac %&gt;% 
    rename(country = name) %&gt;% 
    add_count(country, name = &#39;country_total&#39;) %&gt;% 
    filter(country_total == max(country_total)) %&gt;% 
    arrange(country, date) </code></pre>
<pre class="r"><code>big_mac %&gt;% 
    mutate(country = fct_reorder(country, local_price,
                                 function(.) last(.) / first(.))) %&gt;% 
    ggplot(aes(date, local_price, color = country)) +
    geom_line() +
    facet_wrap( ~country, scales = &#39;free_y&#39;) +
    expand_limits(y = 0) +
    theme(legend.position = &#39;none&#39;) +
    labs(x = &#39;Time&#39;, 
         y = &#39;Price of Big Mac in local currency&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-3-1.png" width="1440" /></p>
<pre class="r"><code>big_mac %&gt;% 
    group_by(country) %&gt;% 
    summarize(big_mac_inflation = last(local_price) / first(local_price)) %&gt;% 
    arrange(desc(big_mac_inflation)) %&gt;% 
    mutate(country = fct_reorder(country, big_mac_inflation)) %&gt;% 
    ggplot(aes(big_mac_inflation, country, fill = country)) +
    geom_col() +
    geom_text(aes(label = paste0(round(big_mac_inflation, 1), &#39;X&#39;)), hjust = 0) +
    scale_x_log10(breaks = c(1, 3, 10, 30, 100)) +
    expand_limits(x = 130) +
    labs(x = &#39;Price of Big Mac in 2020 / Price of Big Mac in 2000&#39;, y = &#39;&#39;) +
    theme(legend.position = &#39;none&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-4-1.png" width="1440" /></p>
<pre class="r"><code>big_mac %&gt;% 
    group_by(date) %&gt;% 
    mutate(usd_price = local_price[iso_a3 == &#39;USA&#39;], 
           us_gdp = gdp_dollar[iso_a3 == &#39;USA&#39;]) %&gt;%
    ungroup() %&gt;% 
    mutate(big_mac_ex = local_price / usd_price) %&gt;% 
    select(date, iso_a3, country, local_price, dollar_ex, usd_price, big_mac_ex, usd_raw, gdp_dollar, us_gdp, usd_adjusted) %&gt;%
    mutate(usd_recalculated = (big_mac_ex - dollar_ex) / dollar_ex) %&gt;% 
    filter(!is.na(gdp_dollar)) %&gt;% 
    head()</code></pre>
<pre><code>## # A tibble: 6 x 12
##   date       iso_a3 country local_price dollar_ex usd_price big_mac_ex
##   &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 2011-07-01 ARG    Argent~          20      4.13      4.07       4.92
## 2 2012-01-01 ARG    Argent~          20      4.31      4.20       4.77
## 3 2012-07-01 ARG    Argent~          19      4.57      4.33       4.39
## 4 2013-01-01 ARG    Argent~          19      4.98      4.37       4.35
## 5 2013-07-01 ARG    Argent~          21      5.41      4.56       4.61
## 6 2014-01-01 ARG    Argent~          21      6.92      4.62       4.54
## # ... with 5 more variables: usd_raw &lt;dbl&gt;, gdp_dollar &lt;dbl&gt;,
## #   us_gdp &lt;dbl&gt;, usd_adjusted &lt;dbl&gt;, usd_recalculated &lt;dbl&gt;</code></pre>
<pre class="r"><code>big_mac %&gt;% 
    select(date, country, local_price, dollar_ex, usd_raw, gdp_dollar, usd_adjusted) %&gt;% 
    filter(!is.na(gdp_dollar)) %&gt;% 
    ggplot(aes(date, usd_raw, color = country)) +
    geom_line(size = 2) +
    expand_limits(y = 0) +
    facet_wrap(~ country, scales = &#39;free_y&#39;) +
    theme(legend.position = &#39;none&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-6-1.png" width="1440" /></p>
<pre class="r"><code>big_mac %&gt;% 
    group_by(date) %&gt;% 
    mutate(usd_price = local_price[iso_a3 == &#39;USA&#39;], 
           us_gdp = gdp_dollar[iso_a3 == &#39;USA&#39;]) %&gt;%
    ungroup() %&gt;% 
    filter(country == &#39;Argentina&#39;, !is.na(gdp_dollar)) %&gt;% 
    mutate(price_from_usd = usd_price * dollar_ex) %&gt;% 
    ggplot(aes(date, local_price)) +
    geom_line(aes(color = &#39;Price (in local currency)&#39;)) +
    geom_line(aes(y = price_from_usd, color = &#39;Price From USD&#39;)) +
    theme(legend.position = &#39;none&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-7-1.png" width="1440" /></p>
<pre class="r"><code>big_mac %&gt;% 
    filter(country != &#39;United States&#39;) %&gt;% 
    select(date, country, local_price, dollar_ex, usd_raw, gdp_dollar, usd_adjusted) %&gt;% 
    filter(!is.na(gdp_dollar)) %&gt;% 
    mutate(country = fct_reorder(country, usd_raw)) %&gt;% 
    ggplot(aes(date, usd_raw, color = country)) +
    geom_line(size = 2) +
    geom_hline(color = &#39;black&#39;, lty = 2, yintercept = 0) + 
    expand_limits(y = 0) +
    facet_wrap(~ country) +
    theme(legend.position = &#39;none&#39;, axis.text.x = element_text(angle =90, hjust =1)) +
    labs(y = &#39;Big Mac Index relative to USD&#39;, x =&#39;&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-8-1.png" width="1440" /></p>
<pre class="r"><code>big_mac %&gt;% 
    filter(date == max(date)) %&gt;% 
    ggplot(aes(gdp_dollar, usd_raw))+
    geom_point() +
    geom_text_repel(aes(label = country)) +
    geom_smooth(method = &#39;lm&#39;) + 
    labs(x = &#39;GDP per capita (dollars)&#39;, 
         y = &#39;Raw Big Max Index relative to USD&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-9-1.png" width="1440" /></p>
<p>In indonesia, big Macs are cheaper than you’d expect based on the currency conversion rate. But this isn’t suprisng, becuase for countries with Indonesia’s GDP per capita it’s roughly par for the course. What we’re really interested in are rich countries with cheap big macs or poor countries with expensive big macs, which indicate that a currency is either undervalued or overvalued respectively.</p>
<pre class="r"><code>big_mac %&gt;% 
    filter(date == max(date)) %&gt;% 
    ggplot(aes(gdp_dollar, usd_adjusted))+
    geom_point() +
    geom_text_repel(aes(label = country)) +
    geom_smooth(method = &#39;lm&#39;) + 
    labs(x = &#39;GDP per capita (dollars)&#39;, 
         y = &#39;Raw Big Max Index relative to USD&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-10-1.png" width="1440" /></p>
<pre class="r"><code>big_mac %&gt;% 
    filter(date == max(date)) %&gt;% 
    mutate(country = fct_reorder(country, usd_adjusted)) %&gt;% 
    ggplot(aes(usd_adjusted, country)) +
    geom_col() +
    labs(x = &#39;Big Mac Index (GDP-adjusted)&#39;, 
    y = &#39;&#39;)</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-11-1.png" width="1440" /></p>
<pre class="r"><code>big_mac %&gt;%
    filter(!is.na(gdp_dollar)) %&gt;% 
    ggplot(aes(gdp_dollar, usd_adjusted))+
    geom_point() +
    geom_text_repel(aes(label = country)) +
    geom_smooth(method = &#39;lm&#39;) + 
    transition_time(date) +
    labs(x = &#39;GDP per capita (dollars)&#39;, 
         y = &#39;Raw Big Max Index relative to USD&#39;,
         title = &#39;{ frame_time }&#39;)</code></pre>
<pre><code>## 
Frame 1 (1%)
Frame 2 (2%)
Frame 3 (3%)
Frame 4 (4%)
Frame 5 (5%)
Frame 6 (6%)
Frame 7 (7%)
Frame 8 (8%)
Frame 9 (9%)
Frame 10 (10%)
Frame 11 (11%)
Frame 12 (12%)
Frame 13 (13%)
Frame 14 (14%)
Frame 15 (15%)
Frame 16 (16%)
Frame 17 (17%)
Frame 18 (18%)
Frame 19 (19%)
Frame 20 (20%)
Frame 21 (21%)
Frame 22 (22%)
Frame 23 (23%)
Frame 24 (24%)
Frame 25 (25%)
Frame 26 (26%)
Frame 27 (27%)
Frame 28 (28%)
Frame 29 (29%)
Frame 30 (30%)
Frame 31 (31%)
Frame 32 (32%)
Frame 33 (33%)
Frame 34 (34%)
Frame 35 (35%)
Frame 36 (36%)
Frame 37 (37%)
Frame 38 (38%)
Frame 39 (39%)
Frame 40 (40%)
Frame 41 (41%)
Frame 42 (42%)
Frame 43 (43%)
Frame 44 (44%)
Frame 45 (45%)
Frame 46 (46%)
Frame 47 (47%)
Frame 48 (48%)
Frame 49 (49%)
Frame 50 (50%)
Frame 51 (51%)
Frame 52 (52%)
Frame 53 (53%)
Frame 54 (54%)
Frame 55 (55%)
Frame 56 (56%)
Frame 57 (57%)
Frame 58 (58%)
Frame 59 (59%)
Frame 60 (60%)
Frame 61 (61%)
Frame 62 (62%)
Frame 63 (63%)
Frame 64 (64%)
Frame 65 (65%)
Frame 66 (66%)
Frame 67 (67%)
Frame 68 (68%)
Frame 69 (69%)
Frame 70 (70%)
Frame 71 (71%)
Frame 72 (72%)
Frame 73 (73%)
Frame 74 (74%)
Frame 75 (75%)
Frame 76 (76%)
Frame 77 (77%)
Frame 78 (78%)
Frame 79 (79%)
Frame 80 (80%)
Frame 81 (81%)
Frame 82 (82%)
Frame 83 (83%)
Frame 84 (84%)
Frame 85 (85%)
Frame 86 (86%)
Frame 87 (87%)
Frame 88 (88%)
Frame 89 (89%)
Frame 90 (90%)
Frame 91 (91%)
Frame 92 (92%)
Frame 93 (93%)
Frame 94 (94%)
Frame 95 (95%)
Frame 96 (96%)
Frame 97 (97%)
Frame 98 (98%)
Frame 99 (99%)
Frame 100 (100%)
## Finalizing encoding... done!</code></pre>
<p><img src="david_big_mac_stream_files/figure-html/unnamed-chunk-12-1.gif" /><!-- --></p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
